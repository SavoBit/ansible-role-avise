---
# These steps will allow a user to specify a private docker repository and login to that
# respository to pull docker images.
#
- name: Avi SE | Docker | Log into the custom docker repository
  shell: "docker login -u {{ docker_repo_user }} -p {{ docker_repo_password}} {{ docker_repo }}"
  register: docker_repo_login
  when:
    - docker_match.stdout == "" or se_version == "latest"
    - docker_repo_user != None
    - docker_repo_password != None

- name: Avi SE | Docker | Load the image from custom docker repository
  shell: "docker pull {{ docker_repo }}/{{ se_image }}"
  register: load_docker_repo
  changed_when: "'Status: Image is up to date' not in load_docker_repo.stdout"
  notify: Avi SE | Services | systemd | Restart the avise service
  when: docker_match.stdout == "" or se_version == "latest"
